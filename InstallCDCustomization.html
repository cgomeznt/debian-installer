<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>InstallCDCustomization - Community Ubuntu Documentation</title>
<script type="text/javascript" src="InstallCDCustomization_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="InstallCDCustomization_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="InstallCDCustomization_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="InstallCDCustomization_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="InstallCDCustomization_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/light/css/msie.css">
<![endif]-->





<link rel="Start" href="https://help.ubuntu.com/community/UserDocumentation">
<link rel="Alternate" title="Wiki Markup" href="https://help.ubuntu.com/community/InstallCDCustomization?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://help.ubuntu.com/community/InstallCDCustomization?action=print">
<link rel="Search" href="https://help.ubuntu.com/community/FindPage">
<link rel="Index" href="https://help.ubuntu.com/community/TitleIndex">
<link rel="Glossary" href="https://help.ubuntu.com/community/WordIndex">
<link rel="Help" href="https://help.ubuntu.com/community/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">


    <div id="leftbanner">
    </div>
    <div id="rightbanner">
    </div>
    <div id="container">
        <div id="container-inner">
	    <div id="mothership">
		<ul>
	            <li><a href="http://www.ubuntu.com/partners">Partners</a> </li>
        	    <li><a href="http://www.ubuntu.com/support">Support</a></li>
        	    <li><a href="http://www.ubuntu.com/community">Community</a></li>
        	    <li><a href="http://www.ubuntu.com/">Ubuntu.com</a></li>
	        </ul>
	    </div>
            <div id="header">
                <h1 id="ubuntu-header"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a></h1>
                <ul id="main-menu">
                    <li><a href="https://help.ubuntu.com/">Official Documentation</a></li>
                    <li><a class="main-menu-item current" href="https://help.ubuntu.com/community">Community Help Wiki</a></li>
                </ul>
            </div>
            <div id="menu-search">
                <div id="subheader"> 
                    <div class="subheader-menu"> 
                        <div id="second-nav">
<ul id="username"><li><a href="https://help.ubuntu.com/community/InstallCDCustomization?action=login&amp;login=1" id="login" rel="nofollow">Login to edit</a></li></ul>
 </div> 
    <div id="user-info"> 
    </div>
 

                            
                        </div> 
                    </div> 


                    <div id="search-box">

<noscript>
 <form action="http://www.google.com/cse" id="cse-search-box">
   <div>
     <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />
     <input type="hidden" name="ie" value="UTF-8" />
     <input type="text" name="q" size="21" />
     <input type="submit" name="sa" value="Search" />
   </div>
 </form>
</noscript>

<script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="21" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script><form action="https://help.ubuntu.com/search.html" id="cse-search-box">  <div>    <input name="cof" value="FORID:9" type="hidden">    <input name="cx" value="004599128559784038176:vj_p0xo-nng" type="hidden">    <input name="ie" value="UTF-8" type="hidden">    <input name="q" size="21" type="text">    <input name="sa" value="Search" type="submit">  </div></form>


                    </div>
                </div>
                <div id="title"><h1>
<span id="pagelocation"><a class="backlink" href="https://help.ubuntu.com/community/InstallCDCustomization?action=fullsearch&amp;value=linkto%3A%22InstallCDCustomization%22&amp;context=180" rel="nofollow" title="Click to do a full-text search for this title">InstallCDCustomization</a></span>
</h1>
                </div>
            <div id="cwt-nav3">

 <hr class="clear">
            </div>
                <div id="cwt-content" class="clearfix content-area">

<div id="page" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867">
</p><h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><div><table style="float: right; font-size: 0.9em; width: 40%; background: none repeat scroll 0% 0% rgb(241, 241, 237); margin: 0px 0px 1em 1em;"><tbody><tr>  <td style="padding: 0.5em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Get_the_Alternate_CD_image">Get the Alternate CD image</a></li><li>
<a href="#Copy_the_CD_to_your_hard_drive">Copy the CD to your hard drive</a></li><li>
<a href="#Modify_installer_behaviour_using_a_Preseed_file">Modify installer behaviour using a Preseed file</a><ol><li>
<a href="#Changing_isolinux.cfg_to_identify_your_preseed">Changing isolinux.cfg to identify your preseed</a></li><li>
<a href="#Writing_the_preseed_file">Writing the preseed file</a><ol><li>
<a href="#Installing_extra_packages_in_your_preseed_file">Installing extra packages in your preseed file</a></li><li>
<a href="#Installing_language_support">Installing language support</a></li><li>
<a href="#Running_a_Final_Script">Running a Final Script</a></li></ol></li></ol></li><li>
<a href="#Modify_pool_structure_to_include_more_packages">Modify pool structure to include more packages</a><ol><li>
<a href="#Create_an_.22Extras.22_component">Create an "Extras" component</a></li><li>
<a href="#Generating_a_new_ubuntu-keyring_.deb_to_sign_your_CD">Generating a new ubuntu-keyring .deb to sign your CD</a></li><li>
<a href="#Building_the_repository_with_apt-ftparchive">Building the repository with apt-ftparchive</a></li></ol></li><li>
<a href="#Burning_the_CD">Burning the CD</a><ol><li>
<a href="#Building_the_ISO_image">Building the ISO image</a></li><li>
<a href="#Burning_the_image_to_CD">Burning the image to CD</a></li></ol></li><li>
<a href="#Testing">Testing</a></li><li>
<a href="#Troubleshooting">Troubleshooting</a></li><li>
<a href="#See_also">See also</a></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line874">The
 process of customizing or "remastering" Ubuntu installation CDs is not 
especially complex, but it is a little tedious and finicky. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line874">The
 Ubuntu installation CD (since Ubuntu 6.06, the 'alternative install' or
 'server' CD) has three main parts: a boot-loader (ISOLINUX on AMD64/x86
 systems, yaboot on PowerPC) and its configuration (which starts 
everything up); debian-installer (also known as d-i, which in this case 
is really a specialized miniature Ubuntu system); and a Debian-style 
repository structure, which is what takes up disk space in the 
directories "pool" and "dists". Building a new CD may involve 
modifications to all three parts. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><p class="line862">This page shows a simple recipe for customizing the CD. It assumes that you copy the contents of the installation CD to <tt class="backtick">/opt/cd-image/</tt> on your local system and create a couple of other dirs in <tt class="backtick">/opt/</tt>. Modify as needed. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></p><p class="line867"><img alt="IconsPage/note.png" class="attachment" src="InstallCDCustomization_files/IconsPage_003.png" title="IconsPage/note.png"> You might speed up the development cycle by using a virtual Ubuntu session, for example, using <a href="https://help.ubuntu.com/community/VirtualBox">VirtualBox</a>.
  You can then use the .ISO file to test rather than burning a CD.  If 
you do, please note that you need to perform ALL operations described 
here on the GUEST system.  Note that with <a href="https://help.ubuntu.com/community/VirtualBox">VirtualBox</a>,
 during an installation (Host key)-F4 will display the installation 
output and (Host key)-F1 will return you to the general status screen.  
Note that the host key is set to the right Ctrl key by default. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p><p class="line867"><img alt="IconsPage/note.png" class="attachment" src="InstallCDCustomization_files/IconsPage_003.png" title="IconsPage/note.png"> This guide is for the 'Alternative Install' or 'Server Install' CDs. There is a page referring to customization of the <a href="https://help.ubuntu.com/community/LiveCDCustomization">Desktop (Live) CD</a>, and another guide on <a href="https://help.ubuntu.com/community/LiveCDCustomizationFromScratch">how to create a Live CD without using an existing CD at all.</a> <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></p><p class="line867">
</p><h1 id="Get_the_Alternate_CD_image">Get the Alternate CD image</h1>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line874">Use the "complete list of download mirrors" <span class="anchor" id="line-26"></span><a class="http" href="http://www.ubuntu.com/getubuntu/downloadmirrors#mirrors">http://www.ubuntu.com/getubuntu/downloadmirrors#mirrors</a> <span class="anchor" id="line-27"></span>Then
 select correct Ubuntu version and from the next page start downloading 
the .iso file from "Alternate install CD" section. Server version should
 also work. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></p><p class="line867">
</p><h1 id="Copy_the_CD_to_your_hard_drive">Copy the CD to your hard drive</h1>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line874">Copy
 the entire installation CD to a directory on your hard drive. This 
guide will assume your CD image is in /opt/cd-image/, but you can put it
 wherever you like. It will take around 1GB of hard drive space. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></p><p class="line874">If you have an ISO file, you can mount it and copy files out of it without burning it to CD: <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></p><pre><span class="anchor" id="line-1"></span>mount -o loop /path/to/iso /some/mountpoint</pre><p class="line874">
 Use "Gmount-iso" program for a GUI method of mounting iso files. You 
can also try "ISO Master" to access the iso file directly without 
mounting.<span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></p><p class="line862">You can use <strong>rsync</strong> to copy the CD: <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></p><pre><span class="anchor" id="line-1-1"></span>rsync -av /cdrom/ /opt/cd-image</pre><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">or just <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line867"><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span></p><pre><span class="anchor" id="line-1-2"></span>mkdir -p /opt/cd-image
<span class="anchor" id="line-2"></span>cp -rT /cdrom /opt/cd-image</pre><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line874">Note:
 the -p option for mkdir creates the leadin directories if they don't 
already exist. In this example, /opt is created if it doesn't already 
exist.  <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></p><p class="line862">Be sure to catch the folder <em>.disk</em> - if you try and copy /cdrom/*, it will ignore the .disk folder, as Bash expands the * to mean "everything it can see". <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><p class="line874">If
 you use a filemanager program like Nautilus, be sure to launch it with 
"gksu nautilus" and mark "Show Hidden Files" from "View" menu or you 
miss some important files. After the copy is done, change file ownership
 from "root" if you don't plan to do the rest of the work with sudo. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></p><p class="line867">
</p><h1 id="Modify_installer_behaviour_using_a_Preseed_file">Modify installer behaviour using a Preseed file</h1>
<span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">When
 the CD boots up, a Linux kernel is started and the installation tasks 
are initiated.  The installer's default behavior can be modified through
 the use of a "preseed" file, which feeds d-i answers to questions 
normally asked by debconf, or in other contexts.  If you look in the <tt class="backtick">preseed</tt>
 folder in the install CD, you'll see that certain options (e.g. 
"server", "expert", "oem") already have preseed files assigned to them. 
 The <a class="https" href="https://help.ubuntu.com/10.04/installation-guide/i386/appendix-preseed.html">installation guide</a> has a detailed appendix on preseeding. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></p><p class="line874">Suppose
 you are installing Ubuntu on a bunch of identical computers, and you 
already know the answers to certain questions (what country and time 
zone you're in, what keyboard you have, how the network should be 
configured, how you want to partition the hard disk, etc).  You can 
"preseed" the answers to these questions in a very simple configuration 
file. <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></p><p class="line867">
</p><h2 id="Changing_isolinux.cfg_to_identify_your_preseed">Changing isolinux.cfg to identify your preseed</h2>
<span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line874">We
 will create a preseed file called 'firewall.seed', which will live in 
the /preseed folder of the CD-ROM. We tell d-i where to find this file 
by modifying the boot-loader configuration file, located in 
isolinux/isolinux.cfg (or in 8.10 or later, isolinux/text.cfg), to pass 
appropriate parameters on the kernel command line.  In 
/opt/cd-image/isolinux/isolinux.cfg, add a new section labeled like 
this: <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span></p><p class="line867"><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span></p><pre><span class="anchor" id="line-1-3"></span>LABEL firewall
<span class="anchor" id="line-2-1"></span>  menu label ^Firewall installation
<span class="anchor" id="line-3"></span>  kernel /install/vmlinuz
<span class="anchor" id="line-4"></span>  append  preseed/file=/cdrom/preseed/firewall.seed debian-installer/locale=en_NZ console-setup/layoutcode=us initrd=/install/initrd.gz ramdisk_size=16384 root=/dev/ram rw quiet --</pre><span class="anchor" id="line-72"></span><p class="line874">If you want to set the default selected menu item to your custom seed, change the DEFAULT line to read 'DEFAULT firewall'. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></p><p class="line874">For
 totally automatic installation with a predefined language (in this 
example, Estonian), you need to add some more parameters: <span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><pre><span class="anchor" id="line-1-4"></span>LABEL firewall
<span class="anchor" id="line-2-2"></span>  menu label ^Firewall installation (Estonian)
<span class="anchor" id="line-3-1"></span>  kernel /install/vmlinuz
<span class="anchor" id="line-4-1"></span>  append  file=/cdrom/preseed/firewall.seed debian-installer/locale=et_EE console-setup/layoutcode=et localechooser/translation/warn-light=true localechooser/translation/warn-severe=true initrd=/install/initrd.gz ramdisk_size=16384 root=/dev/ram rw quiet
<span class="anchor" id="line-5"></span> --</pre><span class="anchor" id="line-82"></span><p class="line874">To
 make the installer autochoose the default option and start installing 
after a timeout, add this line to isolinux/isolinux.cfg (in all 
versions). <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span></p><pre><span class="anchor" id="line-1-5"></span>timeout 10</pre><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line867"><img alt="IconsPage/note.png" class="attachment" src="InstallCDCustomization_files/IconsPage_003.png" title="IconsPage/note.png"> Timeout values are in tenths of a second, therefore a timeout value of 10 is equal to one second. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></p><p class="line874">You
 must specify a locale and keyboard on the command line, as these 
questions are asked before the seed is loaded.  You can also set 
DEBCONF_PRIORITY here to ensure you don't see any unnecessary debconf 
questions. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></p><p class="line862">(On Ubuntu 6.06 and older, use <tt class="backtick">kbd-chooser/method=us</tt> rather than <tt class="backtick">console-setup/layoutcode=us</tt>.) <span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span></p><p class="line867">
</p><h2 id="Writing_the_preseed_file">Writing the preseed file</h2>
<span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line874">A preseed file has 4 fields per line: <span class="anchor" id="line-96"></span></p><ol type="1"><li>identity of the program which will pick up this command <span class="anchor" id="line-97"></span></li><li>name of the variable whose value will be passed <span class="anchor" id="line-98"></span></li><li>variable type <span class="anchor" id="line-99"></span></li><li>value of variable <span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span></li></ol><p class="line874">It looks something like this (from the default ubuntu-server.seed on the 6.06 CD): <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><pre><span class="anchor" id="line-1-6"></span># Always install the server kernel.
<span class="anchor" id="line-2-3"></span>d-i     base-installer/kernel/override-image    string linux-server
<span class="anchor" id="line-3-2"></span># Don't install usplash.
<span class="anchor" id="line-4-2"></span>d-i     base-installer/kernel/linux/extra-packages-2.6  string
<span class="anchor" id="line-5-1"></span># Desktop system not installed; don't waste time and disk space copying it.
<span class="anchor" id="line-6"></span>d-i     archive-copier/desktop-task     string ubuntu-standard
<span class="anchor" id="line-7"></span>d-i     archive-copier/ship-task        string
<span class="anchor" id="line-8"></span># Only install the standard system and language packs.
<span class="anchor" id="line-9"></span>d-i     pkgsel/install-pattern  string ~t^ubuntu-standard$
<span class="anchor" id="line-10"></span>d-i     pkgsel/language-pack-patterns   string
<span class="anchor" id="line-11"></span># No language support packages.
<span class="anchor" id="line-12"></span>d-i     pkgsel/install-language-support boolean false</pre><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span></li></ul><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png"> The version of this file on some Breezy CD images was buggy: it set base-config/package-selection to <tt class="backtick">"~tubuntu-standard"</tt> rather than <tt class="backtick">"~t^ubuntu-standard$"</tt>. Use the new format in preference; the old one will break with Ubuntu 6.06 and newer.) <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span></p><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png">  d-i expects there to be <a class="http" href="http://d-i.alioth.debian.org/manual/en.i386/apbs03.html">exactly one tab or space between variable type and variable value</a> (any other space is seen as being part of the value) <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></p><p class="line874">The easiest way to create a preseed file is to start with an example and modify it: <span class="anchor" id="line-123"></span></p><ol type="1"><li><p class="line862">The Ubuntu installation guide (<a class="https" href="https://help.ubuntu.com/8.04/installation-guide/i386/preseed-contents.html">8.04</a>, <a class="https" href="https://help.ubuntu.com/9.04/installation-guide/i386/preseed-contents.html">9.04</a>, <a class="https" href="https://help.ubuntu.com/9.10/installation-guide/i386/preseed-contents.html">9.10</a>, <a class="https" href="https://help.ubuntu.com/10.04/installation-guide/i386/preseed-contents.html">10.04</a>) has examples of many common preseed directives. (Bear in mind that you may need to modify some to work on older versions.) <span class="anchor" id="line-124"></span></p></li><li><p class="line862">You could check out <a class="http" href="http://wiki.debian.org/DebianInstaller/Preseed">Debian's wiki page on preseeding the installer</a>
 - 6.06 and higher are aligned with Etch and newer versions of the 
Debian installer, although there are some important differences that 
apply to preseeding. <span class="anchor" id="line-125"></span></p></li><li><p class="line862">If
 you can't find the option you're looking for you can generate a 
comprehensive preseed file based on your own install time choices by 
using <tt class="backtick">debconf-get-selections</tt> <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></p></li></ol><p class="line867"><tt class="backtick">debconf-get-selections</tt> usage: <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span></p><pre><span class="anchor" id="line-1-7"></span>sudo apt-get install debconf-utils    # It is part of the debconf-utils package.
<span class="anchor" id="line-2-4"></span>debconf-get-selections --installer &gt; somefile.txt
<span class="anchor" id="line-3-3"></span>debconf-get-selections &gt;&gt; somefile.txt</pre><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line874">This
 will output a list of all debconf options you've chosen throughout your
 install; you can pick options out of this and put them into your 
preseed file. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span></p><p class="line867"><img alt="IconsPage/warning.png" class="attachment" src="InstallCDCustomization_files/IconsPage.png" title="IconsPage/warning.png"> debconf-get-selections prints <strong>2</strong>
 spaces between variable type and variable value.  You need to change 
this to one space before putting the line in a preseed file. <span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span></p><p class="line867">
</p><h3 id="Installing_extra_packages_in_your_preseed_file">Installing extra packages in your preseed file</h3>
<span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line874">base-config has been removed from debian-installer since Ubuntu 6.06. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></p><p class="line874">In Ubuntu 6.06 and older: <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span></p><p class="line867"><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span></p><pre><span class="anchor" id="line-1-8"></span>d-i     pkgsel/install-pattern          string ~t^ubuntu-standard$|~n^openssh-server$</pre><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><p class="line874">In
 Ubuntu 8.04 and newer: (packages may be separated with commas and/or 
spaces and continued to another line with a back-slash): <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></p><p class="line867"><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span></p><pre><span class="anchor" id="line-1-9"></span>d-i     pkgsel/include  string  gstreamer0.10-plugins-base \
<span class="anchor" id="line-2-5"></span> gstreamer0.10-plugins-good \
<span class="anchor" id="line-3-4"></span> gstreamer0.10-plugins-ugly \
<span class="anchor" id="line-4-3"></span> gstreamer0.10-plugins-bad</pre><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867"><img alt="IconsPage/warning.png" class="attachment" src="InstallCDCustomization_files/IconsPage.png" title="IconsPage/warning.png">
 The installer can not install packages which rely on services that 
would normally be running in an installed system, but which are not 
running in the environment of the Debian installer. One example of this 
would be packages which create or modify a database at installation 
time, and require a postgresql or mysql server to be running. In this 
case, you will need to use a postinst script, start the necessary 
database server in the /target chroot, and then call "apt-install" (if 
outside the chroot environment) or apt-get (inside the chroot). <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span></p><p class="line867">
</p><h3 id="Installing_language_support">Installing language support</h3>
<span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line862">A
 different mechanism is used to install additional languages. Preseed 
the detailed locale question asked by the installer in expert mode.  See
 the first column of <tt class="backtick">/usr/share/i18n/SUPPORTED</tt> for the locale names you can use here.  For example, to add support for Bengali and Tamil, use this line: <span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span></p><p class="line867"><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span></p><pre><span class="anchor" id="line-1-10"></span>d-i localechooser/supported-locales multiselect bn_IN, ta_IN</pre><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><p class="line867">
</p><h3 id="Running_a_Final_Script">Running a Final Script</h3>
<span class="anchor" id="line-168"></span><p class="line874">You can run
 a script in the final part of the installation. The following example 
runs a script that has been copied onto the installation CD in the 
setup/install folder.  This script runs in the target environment, thus 
can run scripts in any language (e.g. Python or Perl) that has been 
installed on the target system. <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span></p><p class="line867"><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span></p><pre><span class="anchor" id="line-1-11"></span>d-i preseed/late_command string chroot /target bash /cdrom/setup/install/settings.sh</pre><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line867"><img alt="IconsPage/warning.png" class="attachment" src="InstallCDCustomization_files/IconsPage.png" title="IconsPage/warning.png"> The above command may not work on 8.10 or later; to copy the script to the target and then execute it, try this: <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span></p><p class="line867"><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></p><pre><span class="anchor" id="line-1-12"></span>d-i preseed/late_command string cp /cdrom/finisher/finisher.sh /target/root/; chroot /target chmod +x /root/finisher.sh; chroot /target bash /root/finisher.sh</pre><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line874">Generally,
 a script run from the seed file via late_command, cannot interact with 
the user. If you need to interact, there are generally three options: <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></p><ul><li>Create a custom UDEB that interacts with debconf, and include it with the CD. <span class="anchor" id="line-183"></span></li><li>Create a 'firstrun' script that executes the first time the system boots, and disables itself on completion. <span class="anchor" id="line-184"></span></li><li><p class="line891"><a href="https://help.ubuntu.com/community/InstallCDCustomization/AccessDebconfFromYourScript">Access debconf directly within your script</a>. <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span></p></li></ul><p class="line867"><img alt="IconsPage/warning.png" class="attachment" src="InstallCDCustomization_files/IconsPage.png" title="IconsPage/warning.png">
 A preseed script run via late_command that attempts to run "chroot 
/target apt-get ..." (or similar) may run into problems (e.g. file 
descriptor 3 not found in the postinst stage of some packages, dash 
being one example). This is caused by your script inheriting environment
 variables from the already running installer. To solve this, clear the 
environment variables in your script before calling apt-get: <span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span></p><pre><span class="anchor" id="line-1-13"></span>unset DEBCONF_REDIR
<span class="anchor" id="line-2-6"></span>unset DEBCONF_FRONTEND
<span class="anchor" id="line-3-5"></span>unset DEBIAN_HAS_FRONTEND
<span class="anchor" id="line-4-4"></span>unset DEBIAN_FRONTEND</pre><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line867">
</p><h1 id="Modify_pool_structure_to_include_more_packages">Modify pool structure to include more packages</h1>
<span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><p class="line874">Probably
 the prime motivation to build your own install CDs is to modify which 
packages are installed; in particular you may want to add some packages 
to the CD. <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span></p><p class="line874">The
 easiest way to do this is to build an 'extras' repository structure, 
containing only your extra .debs, and merge these into the CD file 
hierarchy before rebuilding the .ISO image. This guide will step you 
through how to do this. <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></p><p class="line874">This
 requires you to generate the Packages files that defines what files are
 in your repository; the Release file that indexes your Packages files, 
and the signed Release.gpg file, approving the repository as being 
official. <span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span></p><p class="line867">
</p><h2 id="Create_an_.22Extras.22_component">Create an "Extras" component</h2>
<span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png"> The following examples reference Ubuntu 8.04 ("hardy").  Substitute your version where appropriate. <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span></p><p class="line874">Create directories for your new component (substituting your version where appropriate): <span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span></p><p class="line867"><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span></p><pre><span class="anchor" id="line-1-14"></span>cd /opt/cd-image
<span class="anchor" id="line-2-7"></span>mkdir -p dists/hardy/extras/binary-i386/pool/extras/</pre><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line862">Put all the extra .debs you want on your CD into <tt class="backtick">pool/extras</tt>. <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span></p><p class="line862">Create the file <tt class="backtick">dists/hardy/extras/binary-i386/Release</tt> with the following content: <span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span></p><p class="line867"><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span></p><pre><span class="anchor" id="line-1-15"></span>Archive: hardy
<span class="anchor" id="line-2-8"></span>Version: 8.04
<span class="anchor" id="line-3-6"></span>Component: extras
<span class="anchor" id="line-4-5"></span>Origin: Ubuntu
<span class="anchor" id="line-5-2"></span>Label: Ubuntu
<span class="anchor" id="line-6-1"></span>Architecture: i386</pre><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><p class="line862">On the <a href="https://help.ubuntu.com/community/InstallCDCustomization/Scripts">scripts page</a>
 there is a useful script that will strip out all of the packages from 
your CD image that are not currently installed. You will need to run <tt class="backtick">apt-ftparchive</tt> (below) to generate the Packages file. <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span></p><p class="line867">
</p><h2 id="Generating_a_new_ubuntu-keyring_.deb_to_sign_your_CD">Generating a new ubuntu-keyring .deb to sign your CD</h2>
<span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><p class="line862">In
 order to sign the Release file, we need to use GPG.  The install system
 will then check the signature against the public keys held in the 
package ubuntu-keyring. You do not have a private key that matches one 
of the ones in the shipped ubuntu-keyring, so we need to build a custom 
version of the ubuntu-keyring package.  Install the <tt class="backtick">gnupg</tt> package if you do not have it already. <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span></p><p class="line862">To create a signing key, enter <tt class="backtick">gpg&nbsp;--gen-key</tt>.
 Accept the defaults, (for this use, it is probably OK to use "No 
expiry").  For your Real Name and E-mail address, you might like to use 
something like "XXX Signing Key" and "<a class="mailto" href="mailto:packages@xxx.example.org">packages@xxx.example.org</a>". Enter an appropriate passphrase. <span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span></p><p class="line862">In another directory (I use <tt class="backtick">/opt/build/</tt>),
 we will download the source for the ubuntu-keyring package, unpack it, 
add our own GPG key, and rebuild the package. These steps import the 2 
Ubuntu public signing keys into your main keyring, then exports them, 
along with your own public signing key, into a replacement keyring. 
"YOURKEYID" should be replaced with the 8-digit hexadecimal code that 
gpg tells you when you do the --list-keys command. "Signing Key Name" is
 what you used in the previous step, when running <tt class="backtick">gpg&nbsp;--gen-key</tt>. <span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span></p><p class="line874">To
 clarify, below is an example 'gpg --list-keys' response. In this 
example, "YOURKEYID" immediately follows the  '/' on the line beginning 
with 'pub' (which in this example is '437D05B5'.) <span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span></p><p class="line867"><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span></p><pre><span class="anchor" id="line-1-16"></span>gpg --list-keys
<span class="anchor" id="line-2-9"></span>pub   1024D/437D05B5 2006-09-08
<span class="anchor" id="line-3-7"></span>uid                  XXX Signing Key &lt;packages@xxx.example.org&gt;
<span class="anchor" id="line-4-6"></span>sub   2048g/79164387 2006-09-08</pre><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><p class="line874">Here is an example, which you will need to customize to suit your own setup: <span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span></p><p class="line867"><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span></p><pre><span class="anchor" id="line-1-17"></span>cd /opt/build
<span class="anchor" id="line-2-10"></span>sudo apt-get install fakeroot   # requires the fakeroot package which may not be installed on your system.
<span class="anchor" id="line-3-8"></span>apt-get source ubuntu-keyring
<span class="anchor" id="line-4-7"></span>cd ubuntu-keyring-2008.03.04/keyrings
<span class="anchor" id="line-5-3"></span>gpg --import &lt; ubuntu-archive-keyring.gpg
<span class="anchor" id="line-6-2"></span>gpg --list-keys "Signing Key Name"
<span class="anchor" id="line-7-1"></span>gpg --export FBB75451 437D05B5 YOURKEYID &gt; ubuntu-archive-keyring.gpg
<span class="anchor" id="line-8-1"></span>cd ..    # you are now on ubuntu-keyring-2008.03.04
<span class="anchor" id="line-9-1"></span>dpkg-buildpackage -rfakeroot -m"Your Name &lt;your.email@your.host&gt;" -kYOURKEYID
<span class="anchor" id="line-10-1"></span>cd ..  # you are now on the directory where you started, in the example, /opt/build
<span class="anchor" id="line-11-1"></span>cp ubuntu-keyring*deb /opt/cd-image/pool/main/u/ubuntu-keyring</pre><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><p class="line862">You will end up with a udeb file for the installer, and a .deb file for the system.  Both files need to be copied into the <strong>main</strong> component of your CD, because the CD will not check the extras directory. <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span></p><p class="line867">
</p><h2 id="Building_the_repository_with_apt-ftparchive">Building the repository with apt-ftparchive</h2>
<span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line867"><tt class="backtick">apt-ftparchive</tt> builds the <tt class="backtick">Packages</tt> and <tt class="backtick">Packages.gz</tt> files, needed by the installer. In order to use <tt class="backtick">apt-ftparchive</tt> we will need to provide it with some configuration and some index files. <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span></p><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png">
 If you will be adding .deb files to pool/universe (eg. customizing 
xubuntu) you will also need to wget extra.universe and universe files. <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span></p><p class="line862">We will put the index files in <tt class="backtick">/opt/indices</tt>: <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span></p><pre><span class="anchor" id="line-1-18"></span>mkdir -p /opt/indices /opt/apt-ftparchive
<span class="anchor" id="line-2-11"></span>cd /opt/indices/
<span class="anchor" id="line-3-9"></span>DIST=hardy
<span class="anchor" id="line-4-8"></span>for SUFFIX in extra.main main main.debian-installer restricted restricted.debian-installer; do
<span class="anchor" id="line-5-4"></span>  wget http://archive.ubuntu.com/ubuntu/indices/override.$DIST.$SUFFIX
<span class="anchor" id="line-6-3"></span>done</pre><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><p class="line862">Create the files <tt class="backtick">apt-ftparchive-deb.conf</tt>, <tt class="backtick">apt-ftparchive-udeb.conf</tt>, <tt class="backtick">apt-ftparchive-extras.conf</tt>, and <tt class="backtick">release.conf</tt> in a directory (<tt class="backtick">/opt/apt-ftparchive</tt>), substituting <tt class="backtick">/opt/cd-image/</tt> for the path to your CD image directory, and <tt class="backtick">/opt/indices/</tt> for the location of the index files, if they differ. <span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span></p><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png">
 The .conf files shown here are sufficient if you are ONLY making 
changes to .deb files under pool/main and pool/restricted.  If you are 
adding security updates to a Xubuntu customized CD, though, you will be 
updating .deb files under pool/universe also, so you will need to add 
lines to <tt class="backtick">apt-ftparchive-deb.conf</tt> for universe,
 similar to the lines shown for main.  You will also need to run 
extraoverride.pl for universe as well as for main - see below. <span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span></p><p class="line867"><span class="u">/opt/apt-ftparchive/apt-ftparchive-deb.conf:</span> <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><pre><span class="anchor" id="line-1-19"></span>Dir {
<span class="anchor" id="line-2-12"></span>  ArchiveDir "/opt/cd-image/";
<span class="anchor" id="line-3-10"></span>};
<span class="anchor" id="line-4-9"></span>
<span class="anchor" id="line-5-5"></span>TreeDefault {
<span class="anchor" id="line-6-4"></span>  Directory "pool/";
<span class="anchor" id="line-7-2"></span>};
<span class="anchor" id="line-8-2"></span>
<span class="anchor" id="line-9-2"></span>BinDirectory "pool/main" {
<span class="anchor" id="line-10-2"></span>  Packages "dists/hardy/main/binary-i386/Packages";
<span class="anchor" id="line-11-2"></span>  BinOverride "/opt/indices/override.hardy.main";
<span class="anchor" id="line-12-1"></span>  ExtraOverride "/opt/indices/override.hardy.extra.main";
<span class="anchor" id="line-13"></span>};
<span class="anchor" id="line-14"></span>
<span class="anchor" id="line-15"></span>BinDirectory "pool/restricted" {
<span class="anchor" id="line-16"></span> Packages "dists/hardy/restricted/binary-i386/Packages";
<span class="anchor" id="line-17"></span> BinOverride "/opt/indices/override.hardy.restricted";
<span class="anchor" id="line-18"></span>};
<span class="anchor" id="line-19"></span>
<span class="anchor" id="line-20"></span>Default {
<span class="anchor" id="line-21"></span>  Packages {
<span class="anchor" id="line-22"></span>    Extensions ".deb";
<span class="anchor" id="line-23"></span>    Compress ". gzip";
<span class="anchor" id="line-24"></span>  };
<span class="anchor" id="line-25"></span>};
<span class="anchor" id="line-26"></span>
<span class="anchor" id="line-27"></span>Contents {
<span class="anchor" id="line-28"></span>  Compress "gzip";
<span class="anchor" id="line-29"></span>};</pre><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span></li></ul><p class="line862">The <a href="https://help.ubuntu.com/community/ExtraOverride">ExtraOverride</a> component above is needed to add the <tt class="backtick">Task:</tt>
 line to main packages, referenced from the preseed file with ~t&lt;task
 name&gt;. This is not supplied - but can be extracted from the existing
 main Packages file with the simple perl script below. <span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><pre><span class="anchor" id="line-1-20"></span># extraoverride.pl
<span class="anchor" id="line-2-13"></span># generate ExtraOverride file
<span class="anchor" id="line-3-11"></span># use as follows :-
<span class="anchor" id="line-4-10"></span># extraoverride.pl &lt; /opt/cd-image/dists/hardy/main/binary-i386/Packages &gt;&gt; /opt/indices/override.hardy.extra.main
<span class="anchor" id="line-5-6"></span>
<span class="anchor" id="line-6-5"></span>while (&lt;&gt;) {
<span class="anchor" id="line-7-3"></span>        chomp;
<span class="anchor" id="line-8-3"></span>        next if /^ /;
<span class="anchor" id="line-9-3"></span>        if (/^$/ &amp;&amp; defined($task)) {
<span class="anchor" id="line-10-3"></span>                print "$package Task $task\n";
<span class="anchor" id="line-11-3"></span>                undef $package;
<span class="anchor" id="line-12-2"></span>                undef $task;
<span class="anchor" id="line-13-1"></span>        }
<span class="anchor" id="line-14-1"></span>        ($key, $value) = split /: /, $_, 2;
<span class="anchor" id="line-15-1"></span>        if ($key eq 'Package') {
<span class="anchor" id="line-16-1"></span>                $package = $value;
<span class="anchor" id="line-17-1"></span>        }
<span class="anchor" id="line-18-1"></span>        if ($key eq 'Task') {
<span class="anchor" id="line-19-1"></span>                $task = $value;
<span class="anchor" id="line-20-1"></span>        }
<span class="anchor" id="line-21-1"></span>}</pre><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span></li></ul><p class="line867"><img alt="IconsPage/note.png" class="attachment" src="InstallCDCustomization_files/IconsPage_003.png" title="IconsPage/note.png"> If customizing Xubuntu, and adding new .deb files to pool/universe, run this script for the universe repository also. <span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span></p><p class="line867"><span class="u">/opt/apt-ftparchive/apt-ftparchive-udeb.conf:</span> <span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><pre><span class="anchor" id="line-1-21"></span>Dir {
<span class="anchor" id="line-2-14"></span>  ArchiveDir "/opt/cd-image/";
<span class="anchor" id="line-3-12"></span>};
<span class="anchor" id="line-4-11"></span>
<span class="anchor" id="line-5-7"></span>TreeDefault {
<span class="anchor" id="line-6-6"></span>  Directory "pool/";
<span class="anchor" id="line-7-4"></span>};
<span class="anchor" id="line-8-4"></span>
<span class="anchor" id="line-9-4"></span>BinDirectory "pool/main" {
<span class="anchor" id="line-10-4"></span>  Packages "dists/hardy/main/debian-installer/binary-i386/Packages";
<span class="anchor" id="line-11-4"></span>  BinOverride "/opt/indices/override.hardy.main.debian-installer";
<span class="anchor" id="line-12-3"></span>};
<span class="anchor" id="line-13-2"></span>
<span class="anchor" id="line-14-2"></span>BinDirectory "pool/restricted" {
<span class="anchor" id="line-15-2"></span>  Packages "dists/hardy/restricted/debian-installer/binary-i386/Packages";
<span class="anchor" id="line-16-2"></span>  BinOverride "/opt/indices/override.hardy.restricted.debian-installer";
<span class="anchor" id="line-17-2"></span>};
<span class="anchor" id="line-18-2"></span>
<span class="anchor" id="line-19-2"></span>Default {
<span class="anchor" id="line-20-2"></span>  Packages {
<span class="anchor" id="line-21-2"></span>    Extensions ".udeb";
<span class="anchor" id="line-22-1"></span>    Compress ". gzip";
<span class="anchor" id="line-23-1"></span>  };
<span class="anchor" id="line-24-1"></span>};
<span class="anchor" id="line-25-1"></span>
<span class="anchor" id="line-26-1"></span>Contents {
<span class="anchor" id="line-27-1"></span>  Compress "gzip";
<span class="anchor" id="line-28-1"></span>};</pre><span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span></li></ul><p class="line867"><span class="u">/opt/apt-ftparchive/apt-ftparchive-extras.conf:</span> <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><pre><span class="anchor" id="line-1-22"></span>Dir {
<span class="anchor" id="line-2-15"></span>  ArchiveDir "/opt/cd-image/";
<span class="anchor" id="line-3-13"></span>};
<span class="anchor" id="line-4-12"></span>
<span class="anchor" id="line-5-8"></span>TreeDefault {
<span class="anchor" id="line-6-7"></span>  Directory "pool/";
<span class="anchor" id="line-7-5"></span>};
<span class="anchor" id="line-8-5"></span>
<span class="anchor" id="line-9-5"></span>BinDirectory "pool/extras" {
<span class="anchor" id="line-10-5"></span>  Packages "dists/hardy/extras/binary-i386/Packages";
<span class="anchor" id="line-11-5"></span>};
<span class="anchor" id="line-12-4"></span>
<span class="anchor" id="line-13-3"></span>Default {
<span class="anchor" id="line-14-3"></span>  Packages {
<span class="anchor" id="line-15-3"></span>    Extensions ".deb";
<span class="anchor" id="line-16-3"></span>    Compress ". gzip";
<span class="anchor" id="line-17-3"></span>  };
<span class="anchor" id="line-18-3"></span>};
<span class="anchor" id="line-19-3"></span>
<span class="anchor" id="line-20-3"></span>Contents {
<span class="anchor" id="line-21-3"></span>  Compress "gzip";
<span class="anchor" id="line-22-2"></span>};</pre><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span></li></ul><p class="line867"><img alt="IconsPage/important.png" class="attachment" src="InstallCDCustomization_files/IconsPage_002.png" title="IconsPage/important.png"> <span class="anchor" id="line-408"></span>You need to build the Packages file in <em>dists/hardy/extras/binary-i386/Packages</em> using <em>dpkg-scanpackages</em>. See <a class="http" href="http://www.debian.org/doc/manuals/repository-howto/repository-howto">here</a> for an explanation.  <span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span></p><p class="line867"><span class="u">/opt/apt-ftparchive/release.conf</span> <span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span></p><p class="line874">This is the configuration file for apt-ftparchive.  Change to suit your distribution version: <span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span></p><ul><li style="list-style-type:none"><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><pre><span class="anchor" id="line-1-23"></span>APT::FTPArchive::Release::Origin "Ubuntu";
<span class="anchor" id="line-2-16"></span>APT::FTPArchive::Release::Label "Ubuntu";
<span class="anchor" id="line-3-14"></span>APT::FTPArchive::Release::Suite "hardy";
<span class="anchor" id="line-4-13"></span>APT::FTPArchive::Release::Version "8.04";
<span class="anchor" id="line-5-9"></span>APT::FTPArchive::Release::Codename "hardy";
<span class="anchor" id="line-6-8"></span>APT::FTPArchive::Release::Architectures "i386";
<span class="anchor" id="line-7-6"></span>APT::FTPArchive::Release::Components "main restricted extras";
<span class="anchor" id="line-8-6"></span>APT::FTPArchive::Release::Description "Ubuntu 8.04 LTS";</pre><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span></li></ul><p class="line874">To build the repository, sign it, and update the MD5SUM file, you can use a script like this: <span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span></p><p class="line867"><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><span class="anchor" id="line-442"></span></p><pre><span class="anchor" id="line-1-24"></span>BUILD=/opt/cd-image
<span class="anchor" id="line-2-17"></span>APTCONF=/opt/apt-ftparchive/release.conf
<span class="anchor" id="line-3-15"></span>DISTNAME=hardy
<span class="anchor" id="line-4-14"></span>
<span class="anchor" id="line-5-10"></span>pushd $BUILD
<span class="anchor" id="line-6-9"></span>apt-ftparchive -c $APTCONF generate /opt/apt-ftparchive/apt-ftparchive-deb.conf
<span class="anchor" id="line-7-7"></span>apt-ftparchive -c $APTCONF generate /opt/apt-ftparchive/apt-ftparchive-udeb.conf
<span class="anchor" id="line-8-7"></span>apt-ftparchive -c $APTCONF generate /opt/apt-ftparchive/apt-ftparchive-extras.conf
<span class="anchor" id="line-9-6"></span>apt-ftparchive -c $APTCONF release $BUILD/dists/$DISTNAME &gt; $BUILD/dists/$DISTNAME/Release
<span class="anchor" id="line-10-6"></span>
<span class="anchor" id="line-11-6"></span>gpg --default-key "YOURKEYID" --output $BUILD/dists/$DISTNAME/Release.gpg -ba $BUILD/dists/$DISTNAME/Release
<span class="anchor" id="line-12-5"></span>find . -type f -print0 | xargs -0 md5sum &gt; md5sum.txt
<span class="anchor" id="line-13-4"></span>popd</pre><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><p class="line874">"YOURKEYID" is the key id you put in your own compiled keyring package before. <span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span></p><p class="line867">
</p><h1 id="Burning_the_CD">Burning the CD</h1>
<span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><p class="line874">At this point, you have a directory which is ready to be collected into an .ISO file and then burnt to a CD. <span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span></p><p class="line867">
</p><h2 id="Building_the_ISO_image">Building the ISO image</h2>
<span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><p class="line867"><span class="u">x86 and AMD64</span> <span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span></p><p class="line867"><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span></p><pre><span class="anchor" id="line-1-25"></span>IMAGE=custom.iso
<span class="anchor" id="line-2-18"></span>BUILD=/opt/cd-image/
<span class="anchor" id="line-3-16"></span>
<span class="anchor" id="line-4-15"></span>mkisofs -r -V "Custom Ubuntu Install CD" \
<span class="anchor" id="line-5-11"></span>            -cache-inodes \
<span class="anchor" id="line-6-10"></span>            -J -l -b isolinux/isolinux.bin \
<span class="anchor" id="line-7-8"></span>            -c isolinux/boot.cat -no-emul-boot \
<span class="anchor" id="line-8-8"></span>            -boot-load-size 4 -boot-info-table \
<span class="anchor" id="line-9-7"></span>            -o $IMAGE $BUILD</pre><span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><p class="line867"><span class="u">Power PC</span> <span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span></p><p class="line862">Download <a class="http" href="http://people.ubuntu.com/%7Ecjwatson/hfs.map">the HFS map</a>, then use the following command: <span class="anchor" id="line-469"></span><span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span></p><pre><span class="anchor" id="line-1-26"></span>IMAGE=custom.iso
<span class="anchor" id="line-2-19"></span>BUILD=/opt/cd-image/
<span class="anchor" id="line-3-17"></span>
<span class="anchor" id="line-4-16"></span>mkisofs -r -V "Custom Ubuntu Install CD" \
<span class="anchor" id="line-5-12"></span>            --netatalk -hfs -probe -map hfs.map \
<span class="anchor" id="line-6-11"></span>            -chrp-boot -iso-level 2 -part -no-desktop \
<span class="anchor" id="line-7-9"></span>            -hfs-bless $BUILD/install \
<span class="anchor" id="line-8-9"></span>            -hfs-volid Ubuntu/PowerPC_hardy \
<span class="anchor" id="line-9-8"></span>            -o $IMAGE $BUILD</pre><span class="anchor" id="line-480"></span><span class="anchor" id="line-481"></span><p class="line867"><span class="u">ia64</span> <span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span><span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span></p><pre><span class="anchor" id="line-1-27"></span>IMAGE=custom.iso
<span class="anchor" id="line-2-20"></span>BUILD=/opt/cd-image/
<span class="anchor" id="line-3-18"></span>
<span class="anchor" id="line-4-17"></span>mkisofs -r -V 'Custom Ubuntu Install CD' \
<span class="anchor" id="line-5-13"></span>        -o $IMAGE -no-emul-boot \
<span class="anchor" id="line-6-12"></span>        -J -b boot/boot.img -c boot/boot.catalog $BUILD</pre><span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><ul><li style="list-style-type:none">$IMAGE is just the location of your iso image. <span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span></li></ul><p class="line867">
</p><h2 id="Burning_the_image_to_CD">Burning the image to CD</h2>
<span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><p class="line862">To detect the location of your CD drive, try <tt class="backtick">cdrecord&nbsp;--scanbus</tt>.  For a primary IDE CD drive on /dev/hdc: <span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span></p><p class="line867"><span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span></p><pre><span class="anchor" id="line-1-28"></span>sudo nice -18 cdrecord dev=ATA:0,1,0 --speed=24 --blank=fast -v -gracetime=2 -tao $IMAGE</pre><span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><p class="line874">You will burn a lot of coasters in experimenting with this process, so please use rewritable media! <span class="anchor" id="line-502"></span><span class="anchor" id="line-503"></span></p><p class="line867">
</p><h1 id="Testing">Testing</h1>
<span class="anchor" id="line-504"></span><span class="anchor" id="line-505"></span><p class="line874">You
 can now boot off your CD.  Select the new menu item you created.  If 
you've used preseeding to stop the CD asking questions, the installation
 could be totally automatic. <span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span></p><p class="line867">
</p><h1 id="Troubleshooting">Troubleshooting</h1>
<span class="anchor" id="line-508"></span><span class="anchor" id="line-509"></span><ul><li>If your CD fails to read, try re-burning it, possibly at a slower speed. <span class="anchor" id="line-510"></span></li><li>If
 you get a red d-i screen, check the error message (use Alt-F2, Alt-F3 
etc to cycle through the terminals to read the log), and fix your CD 
appropriately. The log file is  /var/log/syslog , check the last lines. <span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span></li></ul><p class="line867">
</p><h1 id="See_also">See also</h1>
<span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span><ul><li><p class="line862">Check out some <a href="https://help.ubuntu.com/community/InstallCDCustomization/Scripts">install CD customization scripts</a> that can be used to automate this process. <span class="anchor" id="line-515"></span></p></li><li><p class="line862">An <a class="http" href="http://striimer.ee/UnattendedUbuntu/MainPage/index.html">"Unattended Ubuntu"</a> guide in Estonian is also available. <span class="anchor" id="line-516"></span></p></li></ul><span class="anchor" id="bottom"></span></div><div id="pagebottom"></div>
</div>


            </div>
<p id="pageinfo" class="info" dir="ltr" lang="en">InstallCDCustomization  (last edited 2011-05-23 16:26:11 by <span title="https://login.launchpad.net/+id/zwfQ4Mn @ 66-189-88-102.dhcp.oxfr.ma.charter.com[66.189.88.102]"><a class="interwiki" href="https://launchpad.net/%7Ejsalisbury" title="https://login.launchpad.net/+id/zwfQ4Mn @ 66-189-88-102.dhcp.oxfr.ma.charter.com[66.189.88.102]">jsalisbury</a></span>)</p>

</div>
            
            <div id="footer">
		<p>
		The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details<br><b>You</b> can contribute to this wiki, see 
		<a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
		</p>
            </div>

        </div>


</body></html>